graph TB
    subgraph "ğŸ¢ SOURCE SYSTEMS"
        K["<b>Karbon</b><br/>â€¢ Individual Budget Allocations<br/>â€¢ Work Item Details<br/>â€¢ Time Tracking Entries<br/>â€¢ Client/User Data"]
    end
    
    subgraph "â„ï¸ SNOWFLAKE DATA WAREHOUSE"
        SF_BVA["<b>WORK_ITEM_BUDGET_VS_ACTUAL</b><br/>â€¢ Individual user budgets<br/>â€¢ Task-level allocations<br/>â€¢ Role-based budgets"]
        SF_WD["<b>WORK_ITEM_DETAILS</b><br/>â€¢ Work item metadata<br/>â€¢ Client assignments<br/>â€¢ Due dates & status"]
        SF_TE["<b>USER_TIME_ENTRY</b><br/>â€¢ Individual time entries<br/>â€¢ Billable/non-billable<br/>â€¢ Daily time logs"]
        SF_DIM["<b>DIMENSION TABLES</b><br/>â€¢ DIMN_CLIENT<br/>â€¢ DIMN_USER<br/>â€¢ DIMN_TENANT_TEAM<br/>â€¢ DIMN_CLIENT_GROUP"]
    end
    
    subgraph "â˜ï¸ GOOGLE CLOUD FUNCTIONS"
        CF_BVA["<b>Budget vs Actual Sync</b><br/>ğŸ”„ Full: sync-full-work-item-budget-vs-actual-to-bq<br/>ğŸ“… Daily: sync-work-item-budget-vs-actual-daily-to-bq<br/>â° Schedule: 6:00 AM UTC"]
        CF_WD["<b>Work Item Details Sync</b><br/>ğŸ”„ Full: work-item-details-sync-full<br/>ğŸ“… Daily: work-item-details-sync-daily<br/>â° Schedule: 6:30 AM UTC"]
        CF_TE["<b>Time Entry Sync</b><br/>ğŸ”„ Full: time-details-sync-full<br/>ğŸ“… Daily: time-details-sync-daily<br/>â° Schedule: 8:00 AM UTC"]
        CF_DIM["<b>Dimension Syncs</b><br/>ğŸ“… Client: 8:00 AM<br/>ğŸ“… User: 8:00 AM<br/>ğŸ“… Teams: 6:00-7:00 AM<br/>ğŸ“… Client Groups: 6:30 AM"]
    end
    
    subgraph "ğŸ—„ï¸ BIGQUERY RAW TABLES"
        BQ_BVA["<b>WORK_ITEM_BUDGET_VS_ACTUAL_BQ</b><br/>ğŸ“Š 35,276 records<br/>ğŸ”‘ WORK_ITEM_ID + REPORTING_DATE<br/>ğŸ“… Latest: 2025-07-15"]
        BQ_WD["<b>WORK_ITEM_DETAILS_BQ</b><br/>ğŸ“Š 1,054,401 records<br/>ğŸ”‘ WORK_ITEM_ID + REPORTING_DATE<br/>ğŸ“… Latest: 2025-07-14"]
        BQ_TE["<b>USER_TIME_ENTRY_BQ</b><br/>ğŸ“Š 31,383 records<br/>ğŸ”‘ TIME_ENTRY_ID<br/>ğŸ“… Latest: 2025-07-23"]
        BQ_DIM["<b>DIMENSION TABLES</b><br/>â€¢ CLIENT_DIMENSION (254)<br/>â€¢ USER_DIMENSION (37)<br/>â€¢ TENANT_TEAM_DIMENSION (6)<br/>â€¢ CLIENT_GROUP_DIMENSION (112)"]
    end
    
    subgraph "ğŸ”„ BIGQUERY ANALYTICS VIEWS"
        BQ_CV["<b>work_item_budget_vs_actual_corrected_view</b><br/>ğŸ¯ Purpose: Fix date filtering<br/>â€¢ Uses work item due dates<br/>â€¢ Corrects sync date issues<br/>â€¢ Adds budget calculations"]
        BQ_V4["<b>WORK_ITEM_BUDGET_TIME_TRACKING_VIEW_V4</b><br/>ğŸ¯ Purpose: Work item level analytics<br/>â€¢ Aggregated work item budgets<br/>â€¢ Time tracking summaries<br/>â€¢ Client & productivity data"]
    end
    
    subgraph "â­ FINAL ANALYTICS VIEW"
        BQ_V5["<b>WORK_ITEM_INDIVIDUAL_BUDGET_TIME_TRACKING_VIEW_V5</b><br/>ğŸ¯ Purpose: Individual user budget vs actual<br/>â€¢ Shows ALL users (budget OR time)<br/>â€¢ Individual budget allocations<br/>â€¢ Actual time tracking per user<br/>â€¢ Budget variance analysis<br/>â€¢ Handles unassigned budgets<br/>â€¢ Comprehensive deduplication"]
    end
    
    subgraph "ğŸ“Š BUSINESS INTELLIGENCE"
        RPT["<b>Reports & Dashboards</b><br/>â€¢ Budget vs Actual Analysis<br/>â€¢ Individual Performance<br/>â€¢ Client Profitability<br/>â€¢ Time Utilization"]
    end
    
    K --> SF_BVA
    K --> SF_WD
    K --> SF_TE
    K --> SF_DIM
    
    SF_BVA --> CF_BVA
    SF_WD --> CF_WD
    SF_TE --> CF_TE
    SF_DIM --> CF_DIM
    
    CF_BVA --> BQ_BVA
    CF_WD --> BQ_WD
    CF_TE --> BQ_TE
    CF_DIM --> BQ_DIM
    
    BQ_BVA --> BQ_CV
    BQ_WD --> BQ_CV
    BQ_CV --> BQ_V5
    BQ_WD --> BQ_V5
    BQ_TE --> BQ_V5
    BQ_DIM --> BQ_V5
    
    BQ_WD --> BQ_V4
    BQ_TE --> BQ_V4
    BQ_DIM --> BQ_V4
    
    BQ_V5 --> RPT
    BQ_V4 --> RPT 